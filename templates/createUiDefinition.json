{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "1.0.0",
  "parameters": {
    "basics": [
            {
                "name": "rgName",
                "type": "Microsoft.Common.TextBox",
                "label": "Resource Group name",
                "placeholder": "",
                "defaultValue": "",
                "toolTip": "Enter a resource group name",
                "constraints": {
                    "required": true,
                    "regex": "^[A-Za-z0-9][A-Za-z0-9-]+[A-Za-z0-9]$",
                    "validationMessage": "Only alphanumeric characters are allowed, and the value must be 1-30 characters long."
                },
                "visible": true  
            },
            {
                "name": "workspaceName",
                "type": "Microsoft.Common.TextBox",
                "label": "Workspace Name",
                "placeholder": "",
                "defaultValue": "",
                "toolTip": "The Workspace name should include 4-63 letters, digits or '-'. The '-' shouldn't be the first or the last symbol.",
                "constraints": {
                    "required": true,
                    "regex": "^[A-Za-z0-9][A-Za-z0-9-]+[A-Za-z0-9]$",
                    "validationMessage": "Only alphanumeric characters are allowed, and the value must be 1-30 characters long."
                },
                "visible": true
            },
            {
                "name": "dailyQuota",
                "type": "Microsoft.Common.TextBox",
                "label": "Daily ingestion limit in GBs. Enter 0 for no limit.",
                "placeholder": "",
                "defaultValue": "0",
                "toolTip": "This limit doesn't apply to the following tables: SecurityAlert, SecurityBaseline, SecurityBaselineSummary, SecurityDetection, SecurityEvent, WindowsFirewall, MaliciousIPCommunication, LinuxAuditLog, SysmonEvent, ProtectionStatus, WindowsEvent. [Learn more](https://learn.microsoft.com/azure/azure-monitor/logs/daily-cap)",
                "constraints": {
                    "required": true,
                    "regex": "^[0-9]{1,4}$",
                    "validationMessage": "Only numbers allowed, and the value must be 1-4 characters long."
                },
                "visible": true
            },
            {
                "name": "dataRetention",
                "type": "Microsoft.Common.TextBox",
                "label": "Number of days of retention",
                "placeholder": "",
                "defaultValue": "90",
                "toolTip": "Only numbers allowed",
                "constraints": {
                    "required": true,
                    "regex": "([3-8][0-9]|9[0-9]|[1-6][0-9]{2}|7[0-2][0-9]|730)",
                    "validationMessage": "Retention must be between 30 and 730 days."
                },
                "visible": true
            },
            {
                "name": "pricingTier",
                "type": "Microsoft.Common.DropDown",
                "label": "Select pricing tier for Sentinel and Log Analytics",
                "placeholder": "",
                "multiselect": false,
                "toolTip": "Visit [Azure Monitor Pricing page](https://azure.microsoft.com/pricing/details/monitor/) for more information.",
                "defaultValue": [{"value": "PerGB2018"}],
                "constraints": {
                    "allowedValues": [
                        {
                            "label": "Pay-as-you-go",
                            "value": "PerGB2018"
                        },
                        {
                            "label": "Commitment Tier",
                            "value": "CapacityReservation"
                        }
                    ],
                    "required": true
                },
                "visible": true
            },
            {
                "name": "capacityReservation",
                "type": "Microsoft.Common.DropDown",
                "label": "Select Commitment Tier for Sentinel and Log Analytics",
                "placeholder": "",
                "multiselect": false,
                "defaultValue": 100,
                "toolTip": "Select the Commitment Tier in GB/day",
                "constraints": {
                    "allowedValues": [
                        {
                            "label": "100 GB",
                            "value": 100
                        },
                        {
                            "label": "200 GB",
                            "value": 200
                        },
                        {
                            "label": "300 GB",
                            "value": 300
                        },
                        {
                            "label": "400 GB",
                            "value": 400
                        },
                        {
                            "label": "500 GB",
                            "value": 500
                        },
                        {
                            "label": "1000 GB",
                            "value": 1000
                        },
                        {
                            "label": "2000 GB",
                            "value": 2000
                        },
                        {
                            "label": "5000 GB",
                            "value": 5000
                        }
                    ],
                    "required": true
                },
                "visible": "[if(equals(basics('pricingTier'),'CapacityReservation'), true, false)]"
            }
          ],
    "steps": [
      {
        "name": "dataconnectors",
        "label": "Data Connectors",
        "elements": [
          {
            "name": "enableDataConnectors",
            "type": "Microsoft.Common.MultiSelect",
            "label": "Enable Data Connectors",
            "toolTip": "Select which data connectors to enable.",
            "defaultValue": [],
            "constraints": {
              "allowedValues": [
                { "label": "Azure Activity Log", "value": "AzureActivityLog" },
                { "label": "Security Event Collection", "value": "SecurityInsightsSecurityEventCollectionConfiguration" },
                { "label": "Windows Firewall", "value": "WindowsFirewall" },
                { "label": "DNS Analytics", "value": "DnsAnalytics" }
              ],
              "required": false
            }
          },
          {
            "name": "aadStreams",
            "type": "Microsoft.Common.MultiSelect",
            "label": "Azure AD Data Streams",
            "defaultValue": [],
            "toolTip": "Select AAD stream types to collect."
          }
        ]
      },
      {
        "name": "solutionSettings",
        "label": "Content Hub Solutions",
        "elements": [
          {
            "name": "enableSolutionsEssentials",
            "type": "Microsoft.Common.MultiSelect",
            "label": "Essentials Solutions",
            "defaultValue": [],
            "toolTip": "Select Content Hub Essentials solutions to enable."
          },
          {
            "name": "enableSolutionsTraining",
            "type": "Microsoft.Common.MultiSelect",
            "label": "Training Solutions",
            "defaultValue": [],
            "toolTip": "Select Content Hub Training solutions to enable."
          }
        ]
      },
      {
        "name": "uebaSettings",
        "label": "UEBA Settings",
        "elements": [
          {
            "name": "enableUEBA",
            "type": "Microsoft.Common.Switch",
            "label": "Enable UEBA",
            "defaultValue": true
          },
          {
            "name": "identityProviders",
            "type": "Microsoft.Common.MultiSelect",
            "label": "Identity Providers",
            "defaultValue": [],
            "toolTip": "Select which identity providers to sync with UEBA.",
            "constraints": {
              "allowedValues": [
                { "label": "ActiveDirectory", "value": "ActiveDirectory" },
                { "label": "AzureActiveDirectory", "value": "AzureActiveDirectory" }
              ]
            },
            "visibleRule": "[parameters('enableUEBA')]"
          }
        ]
      }
    ],
    "outputs": {
      "location": "[location()]",
      "pricingTier": "[parameters('pricingTier')]",
      "dailyQuota": "[parameters('dailyQuota')]",
      "dataRetention": "[parameters('dataRetention')]",
      "enableDataConnectors": "[parameters('enableDataConnectors')]",
      "aadStreams": "[parameters('aadStreams')]",
      "enableSolutionsEssentials": "[parameters('enableSolutionsEssentials')]",
      "enableSolutionsTraining": "[parameters('enableSolutionsTraining')]",
      "enableUEBA": "[parameters('enableUEBA')]",
      "identityProviders": "[parameters('identityProviders')]"
    }
  }
}
