{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "1.0.0",
  "parameters": {
    "basics": [
      {
        "name": "location",
        "type": "Microsoft.Common.Location",
        "label": "Location",
        "defaultValue": "East US",
        "toolTip": "Select the Azure region for the resources."
      }
    ],
    "steps": [
      {
        "name": "workspaceSettings",
        "label": "Workspace Settings",
        "elements": [
          {
            "name": "pricingTier",
            "type": "Microsoft.Common.DropDown",
            "label": "Pricing Tier",
            "defaultValue": "PerGB2018",
            "toolTip": "Choose the pricing tier for Log Analytics.",
            "constraints": {
              "allowedValues": [
                { "label": "CapacityReservation", "value": "CapacityReservation" },
                { "label": "Free", "value": "Free" },
                { "label": "LACluster", "value": "LACluster" },
                { "label": "PerGB2018", "value": "PerGB2018" },
                { "label": "PerNode", "value": "PerNode" },
                { "label": "Premium", "value": "Premium" },
                { "label": "Standalone", "value": "Standalone" },
                { "label": "Standard", "value": "Standard" }
              ]
            }
          },
          {
            "name": "capacityReservation",
            "type": "Microsoft.Common.DropDown",
            "label": "Capacity Reservation (GB)",
            "defaultValue": 100,
            "toolTip": "Select the daily commitment tier.",
            "constraints": {
              "allowedValues": [
                { "label": "100", "value": 100 },
                { "label": "200", "value": 200 },
                { "label": "300", "value": 300 },
                { "label": "400", "value": 400 },
                { "label": "500", "value": 500 },
                { "label": "1000", "value": 1000 },
                { "label": "2000", "value": 2000 },
                { "label": "5000", "value": 5000 }
              ]
            }
          },
          {
            "name": "dailyQuota",
            "type": "Microsoft.Common.TextBox",
            "label": "Daily Quota (GB)",
            "toolTip": "Daily ingestion limit in GBs. Leave blank for unlimited."
          },
          {
            "name": "dataRetention",
            "type": "Microsoft.Common.TextBox",
            "label": "Data Retention (days)",
            "defaultValue": "180",
            "constraints": {
              "regex": "^(7|[8-9]|[1-9][0-9]{1,2}|[1-6][0-9]{2}|7[0-2][0-9]|730)$",
              "validationMessage": "Retention must be between 7 and 730 days."
            }
          }
        ]
      },
      {
        "name": "connectorsSettings",
        "label": "Data Connectors",
        "elements": [
          {
            "name": "enableDataConnectors",
            "type": "Microsoft.Common.MultiSelect",
            "label": "Enable Data Connectors",
            "defaultValue": [],
            "toolTip": "Select which data connectors to enable.",
            "constraints": {
              "allowedValues": [
                { "label": "AzureActivityLog", "value": "AzureActivityLog" },
                { "label": "SecurityInsightsSecurityEventCollectionConfiguration", "value": "SecurityInsightsSecurityEventCollectionConfiguration" },
                { "label": "WindowsFirewall", "value": "WindowsFirewall" },
                { "label": "DnsAnalytics", "value": "DnsAnalytics" }
              ]
            }
          },
          {
            "name": "aadStreams",
            "type": "Microsoft.Common.MultiSelect",
            "label": "Azure AD Data Streams",
            "defaultValue": [],
            "toolTip": "Select AAD stream types to collect."
          }
        ]
      },
      {
        "name": "solutionSettings",
        "label": "Content Hub Solutions",
        "elements": [
          {
            "name": "enableSolutionsEssentials",
            "type": "Microsoft.Common.MultiSelect",
            "label": "Essentials Solutions",
            "defaultValue": [],
            "toolTip": "Select Content Hub Essentials solutions to enable."
          },
          {
            "name": "enableSolutionsTraining",
            "type": "Microsoft.Common.MultiSelect",
            "label": "Training Solutions",
            "defaultValue": [],
            "toolTip": "Select Content Hub Training solutions to enable."
          }
        ]
      },
      {
        "name": "uebaSettings",
        "label": "UEBA Settings",
        "elements": [
          {
            "name": "enableUEBA",
            "type": "Microsoft.Common.Switch",
            "label": "Enable UEBA",
            "defaultValue": true
          },
          {
            "name": "identityProviders",
            "type": "Microsoft.Common.MultiSelect",
            "label": "Identity Providers",
            "defaultValue": [],
            "toolTip": "Select which identity providers to sync with UEBA.",
            "constraints": {
              "allowedValues": [
                { "label": "ActiveDirectory", "value": "ActiveDirectory" },
                { "label": "AzureActiveDirectory", "value": "AzureActiveDirectory" }
              ]
            },
            "visibleRule": "[parameters('enableUEBA')]"
          }
        ]
      }
    ],
    "outputs": {
      "location": "[location()]",
      "pricingTier": "[parameters('pricingTier')]",
      "capacityReservation": "[parameters('capacityReservation')]",
      "dailyQuota": "[parameters('dailyQuota')]",
      "dataRetention": "[parameters('dataRetention')]",
      "enableDataConnectors": "[parameters('enableDataConnectors')]",
      "aadStreams": "[parameters('aadStreams')]",
      "enableSolutionsEssentials": "[parameters('enableSolutionsEssentials')]",
      "enableSolutionsTraining": "[parameters('enableSolutionsTraining')]",
      "enableUEBA": "[parameters('enableUEBA')]",
      "identityProviders": "[parameters('identityProviders')]"
    }
  }
}
