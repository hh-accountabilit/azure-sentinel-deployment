
{
  "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "0.1.2-preview",
  "parameters": {
    "config": {
      "isWizard": false,
      "basics": {
        "description": "Provision a Log Analytics workspace, enable Microsoft Sentinel, and optionally configure connectors, UEBA, solutions, and a lab VM.",
        "location": {
          "label": "Location",
          "visible": true
          "allowedValues": [ "eastus", "westus3", "centralus" ]
        }
      }
    },
    "basics": [
      {
        "name": "pricingTier",
        "type": "Microsoft.Common.DropDown",
        "label": "Workspace pricing tier",
        "defaultValue": "PerGB2018",
        "constraints": {
          "allowedValues": [
            { "label": "CapacityReservation", "value": "CapacityReservation" },
            { "label": "Free",               "value": "Free" },
            { "label": "LACluster",          "value": "LACluster" },
            { "label": "PerGB2018",          "value": "PerGB2018" },
            { "label": "PerNode",            "value": "PerNode" },
            { "label": "Premium",            "value": "Premium" },
            { "label": "Standalone",         "value": "Standalone" },
            { "label": "Standard",           "value": "Standard" }
          ],
          "required": true
        }
      },
      {
        "name": "dataRetention",
        "type": "Microsoft.Common.Slider",
        "label": "Data retention (days)",
        "min": 7,
        "max": 730,
        "step": 1,
        "defaultValue": 180
      },
      {
        "name": "dailyQuota",
        "type": "Microsoft.Common.TextBox",
        "label": "Daily ingestion quota (GB, 0 = unlimited)",
        "defaultValue": "0",
        "constraints": {
          "regex": "^[0-9]{1,4}$",
          "validationMessage": "Enter an integer GB value (0â€“9999)."
        },
        "visible": true
      }
    ],
    "steps": [
      {
        "name": "dataConnectors",
        "label": "Data connectors",
        "elements": [
          {
            "name": "infoBoxConnectors",
            "type": "Microsoft.Common.InfoBox",
            "options": {
              "icon": "Info",
              "text": "Select which data connectors to configure in Microsoft Sentinel. Some connectors require installing a Content Hub solution first.",
              "uri": "https://learn.microsoft.com/azure/sentinel/data-connectors-reference"
            }
          },
          {
            "name": "enableDataConnectors",
            "type": "Microsoft.Common.DropDown",
            "label": "Select data connectors to onboard",
            "multiselect": true,
            "filter": true,
            "filterPlaceholder": "Filter connectors...",
            "constraints": {
              "allowedValues": [
                { "label": "Azure Active Directory",                       "value": "AzureActiveDirectory" },
                { "label": "Azure Active Directory Identity Protection",   "value": "AzureActiveDirectoryIDP" },
                { "label": "Azure Activity",                                "value": "AzureActivity" },
                { "label": "Dynamics 365",                                  "value": "Dynamics365" },
                { "label": "Microsoft 365 Defender",                        "value": "Microsoft365Defender" },
                { "label": "Microsoft Defender for Cloud",                  "value": "MicrosoftDefenderForCloud" },
                { "label": "Microsoft Insider Risk Management",             "value": "OfficeIRM" },
                { "label": "Microsoft Power BI",                            "value": "OfficePowerBI" },
                { "label": "Microsoft Project",                             "value": "Office365Project" },
                { "label": "Office 365",                                    "value": "Office365" },
                { "label": "Threat Intelligence Platforms",                 "value": "ThreatIntelligence" }
              ]
            }
          },
          {
            "name": "aadStreams",
            "type": "Microsoft.Common.DropDown",
            "label": "Azure AD (Entra ID) log types",
            "multiselect": true,
            "filter": true,
            "defaultValue": [ "SignInLogs", "AuditLogs" ],
            "constraints": {
              "allowedValues": [
                { "label": "Sign-in Logs",                               "value": "SignInLogs" },
                { "label": "Audit Logs",                                 "value": "AuditLogs" },
                { "label": "Non-Interactive User Sign-in (Preview)",     "value": "NonInteractiveUserSignInLogs" },
                { "label": "Service Principal Sign-in (Preview)",        "value": "ServicePrincipalSignInLogs" },
                { "label": "Managed Identity Sign-in (Preview)",         "value": "ManagedIdentitySignInLogs" },
                { "label": "Provisioning Logs (Preview)",                "value": "ProvisioningLogs" },
                { "label": "ADFS Sign-in Logs (Preview)",                "value": "ADFSSignInLogs" },
                { "label": "User Risk Events (Preview)",                 "value": "UserRiskEvents" },
                { "label": "Risky Users (Preview)",                      "value": "RiskyUsers" },
                { "label": "Network Access Traffic Logs (Preview)",      "value": "NetworkAccessTrafficLogs" },
                { "label": "Risky Service Principals (Preview)",         "value": "RiskyServicePrincipals" },
                { "label": "Service Principal Risk Events (Preview)",    "value": "ServicePrincipalRiskEvents" }
              ],
              "required": false
            },
            "visible": "[contains(steps('dataConnectors').enableDataConnectors, 'AzureActiveDirectory')]"
          }
        ]
      },
      {
        "name": "ueba",
        "label": "UEBA",
        "elements": [
          {
            "name": "enableUEBA",
            "type": "Microsoft.Common.CheckBox",
            "label": "Enable UEBA (User and Entity Behavior Analytics)",
            "defaultValue": true
          },
          {
            "name": "identityProviders",
            "type": "Microsoft.Common.DropDown",
            "label": "Identity providers for UEBA sync",
            "multiselect": true,
            "filter": true,
            "constraints": {
              "allowedValues": [
                { "label": "Microsoft Entra ID (Azure AD)", "value": "EntraID" },
                { "label": "Okta",                           "value": "Okta" },
                { "label": "PingFederate",                   "value": "Ping" },
                { "label": "AD FS",                          "value": "ADFS" }
              ]
            },
            "visible": "[steps('ueba').enableUEBA]"
          }
        ]
      },
      {
        "name": "contentHubSolutions",
        "label": "Content Hub solutions",
        "elements": [
          {
            "name": "enableSolutionsTraining",
            "type": "Microsoft.Common.DropDown",
            "label": "Training solutions to deploy",
            "multiselect": true,
            "filter": true,
            "defaultValue": [],
            "constraints": {
              "allowedValues": [
                { "label": "SOC Training Pack",   "value": "SOCTP" },
                { "label": "Threat Hunting",      "value": "ThreatHunting" },
                { "label": "Incident Response",   "value": "IncidentResponse" }
              ]
            }
          },
          {
            "name": "enableSolutionsEssentials",
            "type": "Microsoft.Common.DropDown",
            "label": "Essentials solutions to deploy",
            "multiselect": true,
            "filter": true,
            "defaultValue": [],
            "constraints": {
              "allowedValues": [
                { "label": "Azure Essentials Pack", "value": "AzureEssentials" },
                { "label": "Security Essentials",    "value": "SecurityEssentials" }
              ]
            }
          }
        ]
      },
      {
        "name": "vmSettings",
        "label": "Virtual machine (optional)",
        "elements": [
          {
            "name": "vmName",
            "type": "Microsoft.Common.TextBox",
            "label": "VM name",
            "constraints": {
              "required": false,
              "regex": "^[a-zA-Z0-9-]{1,64}$",
              "validationMessage": "Alphanumeric and dashes, up to 64 characters."
            }
          },
          {
            "name": "vmSize",
            "type": "Microsoft.Compute.SizeSelector",
            "label": "VM size",
            "osPlatform": "linux",
            "visible": "[greater(length(steps('vmSettings').vmName), 0)]"
          },
          {
            "name": "adminPassword",
            "type": "Microsoft.Common.PasswordBox",
            "label": "Admin password",
            "constraints": { "required": false },
            "visible": "[greater(length(steps('vmSettings').vmName), 0)]"
          },
          {
            "name": "osDiskSize",
            "type": "Microsoft.Common.Slider",
            "label": "OS Disk size (GB)",
            "min": 30,
            "max": 2048,
            "step": 1,
            "defaultValue": 256,
            "visible": "[greater(length(steps('vmSettings').vmName), 0)]"
          }
        ]
      }
    ],
    "outputs": {
      "pricingTier": "[basics('pricingTier')]",
      "dataRetention": "[basics('dataRetention')]",
      "dailyQuota": "[int(basics('dailyQuota'))]",
      "enableDataConnectors": "[steps('dataConnectors').enableDataConnectors]",
      "aadStreams": "[steps('dataConnectors').aadStreams]",
      "enableUEBA": "[steps('ueba').enableUEBA]",
      "identityProviders": "[steps('ueba').identityProviders]",
      "enableSolutionsTraining": "[steps('contentHubSolutions').enableSolutionsTraining]",
      "enableSolutionsEssentials": "[steps('contentHubSolutions').enableSolutionsEssentials]",
      "vmName": "[steps('vmSettings').vmName]",
      "vmSize": "[steps('vmSettings').vmSize]",
      "adminPassword": "[steps('vmSettings').adminPassword]",
      "osDiskSize": "[steps('vmSettings').osDiskSize]"
    }
  }
}

