{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "location": {
      "type": "string",
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Location for all resources."
      }
    },
    "pricingTier": {
      "type": "string",
      "allowedValues": [
        "CapacityReservation",
        "Free",
        "LACluster",
        "PerGB2018",
        "PerNode",
        "Premium",
        "Standalone",
        "Standard"
      ],
      "defaultValue": "PerGB2018",
      "metadata": {
        "description": "Pricing tier for the workspace."
      }
    },
    "capacityReservation": {
      "type": "int",
      "allowedValues": [
        100,
        200,
        300,
        400,
        500,
        1000,
        2000,
        5000
      ],
      "defaultValue": 100,
      "metadata": {
        "description": "Commitment tier"
      }
    },
    "dailyQuota": {
      "type": "int",
      "metadata": {
        "description": "Daily ingestion limit in GBs"
      }
    },
    "dataRetention": {
      "type": "int",
      "defaultValue": 180,
      "minValue": 7,
      "maxValue": 730,
      "metadata": {
        "description": "Data retention days."
      }
    },
    "enableDataConnectors": {
      "type": "array",
      "defaultValue": [],
      "metadata": {
        "description": "Select data connectors to onboard"
      }
    },
    "aadStreams": {
      "type": "array",
      "defaultValue": [],
      "metadata": {
        "description": "Select Azure Active Directory log types"
      }
    },
    "enableUEBA": {
      "type": "bool",
      "defaultValue": true,
      "metadata": {
        "description": "Enable UEBA (User and Entity Behavior Analytics)"
      }
    },
    "identityProviders": {
      "type": "array",
      "defaultValue": [],
      "metadata": {
        "description": "Identity providers for UEBA sync"
      }
    },
    "enableSolutionsTraining": {
      "type": "array",
      "defaultValue": [],
      "metadata": {
        "description": "Content Hub Training solutions"
      }
    },
    "enableSolutionsEssentials": {
      "type": "array",
      "defaultValue": [],
      "metadata": {
        "description": "Content Hub Essentials solutions"
      }
    },
    "vmName": {
      "type": "string",
      "metadata": {
        "description": "Virtual machine name"
      }
    },
    "vmSize": {
      "type": "string",
      "metadata": {
        "description": "Virtual machine size"
      }
    },
    "adminPassword": {
      "type": "securestring",
      "metadata": {
        "description": "Admin password"
      }
    },
    "osDiskSize": {
      "type": "int",
      "defaultValue": 256,
      "metadata": {
        "description": "OS Disk Size (GB)"
      }
    }
  },
  "uiDefinition": {
    "handler": "Microsoft.Azure.Portal",
    "version": "1.0",
    "parameters": {
      "location": {},
      "pricingTier": {},
      "capacityReservation": {},
      "dailyQuota": {},
      "dataRetention": {},
      "enableDataConnectors": {},
      "aadStreams": {},
      "enableUEBA": {},
      "identityProviders": {},
      "enableSolutionsTraining": {},
      "enableSolutionsEssentials": {},
      "vmName": {},
      "vmSize": {},
      "adminPassword": {},
      "osDiskSize": {}
    },
    "tabs": [
      {
        "name": "workspaceSettings",
        "label": "Workspace Settings",
        "elements": [
          {
            "name": "location",
            "type": "Microsoft.Common.DropDown",
            "label": "Location",
            "defaultValue": "[resourceGroup().location]",
            "options": {
              "disableFilter": false
            }
          },
          {
            "name": "pricingTier",
            "type": "Microsoft.Common.DropDown",
            "label": "Pricing Tier",
            "defaultValue": "PerGB2018",
            "constraints": {
              "allowedValues": [
                "CapacityReservation",
                "Free",
                "LACluster",
                "PerGB2018",
                "PerNode",
                "Premium",
                "Standalone",
                "Standard"
              ]
            }
          },
          {
            "name": "capacityReservation",
            "type": "Microsoft.Common.DropDown",
            "label": "Capacity Reservation",
            "defaultValue": 100,
            "constraints": {
              "allowedValues": [
                100,
                200,
                300,
                400,
                500,
                1000,
                2000,
                5000
              ]
            }
          },
          {
            "name": "dailyQuota",
            "type": "Microsoft.Common.TextBox",
            "label": "Daily Ingestion Quota (GB)"
          },
          {
            "name": "dataRetention",
            "type": "Microsoft.Common.TextBox",
            "label": "Data Retention (days)",
            "defaultValue": 180,
            "constraints": {
              "required": true,
              "regex": "^(7|[1-9][0-9]{1,2}|730)$",
              "validationMessage": "Retention must be between 7 and 730 days"
            }
          }
        ]
      },
      {
        "name": "dataConnectors",
        "label": "Data Connectors",
        "elements": [
          {
            "name": "infoBoxConnectors",
            "type": "Microsoft.Common.InfoBox",
            "options": {
              "icon": "Info",
              "text": "Select which Data Connectors to configure in your Microsoft Sentinel environment.",
              "uri": "https://learn.microsoft.com/azure/sentinel/data-connectors-reference"
            }
          },
          {
            "name": "enableDataConnectors",
            "type": "Microsoft.Common.DropDown",
            "label": "Select Data Connectors to Onboard",
            "multiselect": true,
            "filter": true,
            "filterPlaceholder": "Filter connectors...",
            "constraints": {
              "allowedValues": [
                { "label": "Azure Active Directory", "value": "AzureActiveDirectory" },
                { "label": "Azure Active Directory Identity Protection", "value": "AzureActiveDirectoryIDP" },
                { "label": "Azure Activity", "value": "AzureActivity" },
                { "label": "Dynamics 365", "value": "Dynamics365" },
                { "label": "Microsoft 365 Defender", "value": "Microsoft365Defender" },
                { "label": "Microsoft Defender for Cloud", "value": "MicrosoftDefenderForCloud" },
                { "label": "Microsoft Insider Risk Management", "value": "OfficeIRM" },
                { "label": "Microsoft PowerBI", "value": "OfficePowerBI" },
                { "label": "Microsoft Project", "value": "Office365Project" },
                { "label": "Office 365", "value": "Office365" },
                { "label": "Threat Intelligence Platforms", "value": "ThreatIntelligence" }
              ],
              "required": true
            }
          },
          {
            "name": "aadStreams",
            "type": "Microsoft.Common.DropDown",
            "label": "Select Azure Active Directory Log Types",
            "multiselect": true,
            "filter": true,
            "filterPlaceholder": "Filter log types...",
            "defaultValue": [
              { "value": "SignInLogs" },
              { "value": "AuditLogs" }
            ],
            "constraints": {
              "allowedValues": [
                { "label": "Signin Logs", "value": "SignInLogs" },
                { "label": "Audit Logs", "value": "AuditLogs" },
                { "label": "Non-Interactive User Sign-In Log (Preview)", "value": "NonInteractiveUserSignInLogs" },
                { "label": "Service Principal Sign-In Logs (Preview)", "value": "ServicePrincipalSignInLogs" },
                { "label": "Managed Identity Sign-In Logs (Preview)", "value": "ManagedIdentitySignInLogs" },
                { "label": "Provisioning Logs (Preview)", "value": "ProvisioningLogs" },
                { "label": "ADFS Sign-In Logs (Preview)", "value": "ADFSSignInLogs" },
                { "label": "User Risk Events (Preview)", "value": "UserRiskEvents" },
                { "label": "Risky Users (Preview)", "value": "RiskyUsers" },
                { "label": "Network Access Traffic Logs (Preview)", "value": "NetworkAccessTrafficLogs" },
                { "label": "Risky Service Principals (Preview)", "value": "RiskyServicePrincipals" },
                { "label": "Service Principal Risk Events (Preview)", "value": "ServicePrincipalRiskEvents" }
              ],
              "required": false
            },
            "visible": "[if(contains(parameters('enableDataConnectors'),'AzureActiveDirectory'), true, false)]"
          }
        ]
      },
{
  "name": "contentHubSolutions",
  "label": "Content Hub Solutions",
  "elements": [
    {
      "name": "enableSolutionsTraining",
      "type": "Microsoft.Common.DropDown",
      "label": "Training Solutions to Deploy",
      "multiselect": true,
      "filter": true,
      "filterPlaceholder": "Filter training solutions...",
      "defaultValue": [],
      "constraints": {
        "allowedValues": [
          { "label": "SOC Training Pack", "value": "SOCTP" },
          { "label": "Threat Hunting", "value": "ThreatHunting" },
          { "label": "Incident Response", "value": "IncidentResponse" }
        ]
      }
    },
    {
      "name": "enableSolutionsEssentials",
      "type": "Microsoft.Common.DropDown",
      "label": "Essentials Solutions to Deploy",
      "multiselect": true,
      "filter": true,
      "filterPlaceholder": "Filter essentials solutions...",
      "defaultValue": [],
      "constraints": {
        "allowedValues": [
          { "label": "Azure Essentials Pack", "value": "AzureEssentials" },
          { "label": "Security Essentials", "value": "SecurityEssentials" }
        ]
      }
    }
  ]
},
      {
        "name": "vmSettings",
        "label": "Virtual Machine Settings",
        "elements": [
          {
            "name": "vmName",
            "type": "Microsoft.Common.TextBox",
            "label": "VM Name",
            "constraints": {
              "required": true,
              "regex": "^[a-zA-Z0-9-]{1,64}$",
              "validationMessage": "VM name must be alphanumeric and up to 64 characters."
            }
          },
          {
            "name": "vmSize",
            "type": "Microsoft.Compute.SizeSelector",
            "label": "VM Size",
            "osPlatform": "linux"
          },
          {
            "name": "adminPassword",
            "type": "Microsoft.Common.PasswordBox",
            "label": "Admin Password",
            "constraints": {
              "required": true
            }
          },
          {
            "name": "osDiskSize",
            "type": "Microsoft.Common.TextBox",
            "label": "OS Disk Size (GB)",
            "defaultValue": 256,
            "constraints": {
              "minValue": 30,
              "maxValue": 2048
            }
          }
        ]
      }
    ]
  }
}
